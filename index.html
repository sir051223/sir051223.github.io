<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta property="og:type" content="website">
<meta property="og:title" content="Forest">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Forest">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Forest">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Forest</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Forest</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/28/php/getMac/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sir051223">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Forest">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/28/php/getMac/" itemprop="url">php通过ARP地址解析协议获取用户设备的mac地址</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-28T14:52:54+08:00">
                2019-02-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Php/" itemprop="url" rel="index">
                    <span itemprop="name">Php</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="一、ARP地址解析协议"><a href="#一、ARP地址解析协议" class="headerlink" title="一、ARP地址解析协议"></a>一、ARP地址解析协议</h3><p>ARP的功能是在32bit的ip地址和采用不同网络技术的硬件地址之间提供动态映射。<br>ARP高速运行的关键是由于每个主机上都有一个ARP高速缓存，这个高速缓存存放了最近Internet地址到硬件地址之间的映射记录。<br>可以在linux中通过命令arp -a查看，参数-a的意思是显示高速缓存中所有的内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">  <span class="comment"># arp -a</span></div><div class="line">? (192.168.31.53) at f4:60:e2:a7:f7:60 [ether] on enp4s0</div><div class="line">? (192.168.31.109) at 94:bf:2d:52:42:34 [ether] on enp4s0</div><div class="line">gateway (192.168.31.1) at 84:5b:12:4b:14:41 [ether] on enp4s0</div><div class="line">? (192.168.31.152) at 3c:52:82:67:8d:b9 [ether] on enp4s0</div><div class="line">  </div><div class="line">  这里列举了最近20分钟访问的ip及ip对应的mac地址</div></pre></td></tr></table></figure>
<h3 id="二、php代码实现"><a href="#二、php代码实现" class="headerlink" title="二、php代码实现"></a>二、php代码实现</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;?php  </div><div class="line"></div><div class="line">/**</div><div class="line"> * 获取客户端IP地址</div><div class="line"> * @param <span class="built_in">integer</span> <span class="variable">$type</span> 返回类型 0 返回IP地址 1 返回IPV4地址数字</div><div class="line"> * @<span class="built_in">return</span> mixed</div><div class="line"> */</div><div class="line"><span class="keyword">function</span> getClientIp(<span class="variable">$type</span> = 0) </div><div class="line">&#123;</div><div class="line">    <span class="variable">$ip</span> = <span class="string">""</span>;</div><div class="line">    <span class="keyword">if</span> (getenv(<span class="string">'HTTP_CLIENT_IP'</span>) &amp;&amp; strcasecmp(getenv(<span class="string">'HTTP_CLIENT_IP'</span>), <span class="string">'unknown'</span>)) &#123;</div><div class="line">        <span class="variable">$ip</span> = getenv(<span class="string">'HTTP_CLIENT_IP'</span>);</div><div class="line">    &#125; elseif (getenv(<span class="string">'HTTP_X_FORWARDED_FOR'</span>) &amp;&amp; strcasecmp(getenv(<span class="string">'HTTP_X_FORWARDED_FOR'</span>), <span class="string">'unknown'</span>)) &#123;</div><div class="line">        <span class="variable">$ip</span> = getenv(<span class="string">'HTTP_X_FORWARDED_FOR'</span>);</div><div class="line">    &#125; elseif (getenv(<span class="string">'REMOTE_ADDR'</span>) &amp;&amp; strcasecmp(getenv(<span class="string">'REMOTE_ADDR'</span>), <span class="string">'unknown'</span>)) &#123;</div><div class="line">        <span class="variable">$ip</span> = getenv(<span class="string">'REMOTE_ADDR'</span>);</div><div class="line">    &#125; elseif (isset(<span class="variable">$_SERVER</span>[<span class="string">'REMOTE_ADDR'</span>]) &amp;&amp; <span class="variable">$_SERVER</span>[<span class="string">'REMOTE_ADDR'</span>] &amp;&amp; strcasecmp(<span class="variable">$_SERVER</span>[<span class="string">'REMOTE_ADDR'</span>], <span class="string">'unknown'</span>)) &#123;</div><div class="line">        <span class="variable">$ip</span> = <span class="variable">$_SERVER</span>[<span class="string">'REMOTE_ADDR'</span>];</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">return</span> <span class="variable">$ip</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line"> * 获得用户设备的mac地址</div><div class="line"> * 通过arp执行控制台程序，得到控制台的返回，然后处理控制台的信息，从ip查询得到mac地址</div><div class="line"> * @<span class="built_in">return</span> unknown</div><div class="line"> */</div><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">getMac</span></span>()</div><div class="line">&#123;</div><div class="line">	<span class="variable">$ip</span> =  getClientIp();</div><div class="line">	<span class="variable">$command</span> = <span class="string">"arp"</span>;</div><div class="line">	<span class="variable">$data</span> = <span class="built_in">exec</span>(<span class="variable">$command</span>, <span class="variable">$out</span>);</div><div class="line">	</div><div class="line">	<span class="variable">$ipstr</span> = <span class="string">""</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="variable">$i</span> = 0; <span class="variable">$i</span> &lt; count(<span class="variable">$out</span>); <span class="variable">$i</span>++) &#123;</div><div class="line">		<span class="keyword">if</span> (strpos(<span class="variable">$out</span>[<span class="variable">$i</span>], <span class="variable">$ip</span>) === 0) &#123;</div><div class="line">			<span class="variable">$ipstr</span> = <span class="variable">$out</span>[<span class="variable">$i</span>];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span>(<span class="variable">$ipstr</span> != <span class="string">""</span>) &#123;</div><div class="line">		<span class="variable">$strs</span> = my_split(<span class="variable">$ipstr</span>, <span class="string">" "</span>);</div><div class="line">		<span class="built_in">return</span> <span class="variable">$strs</span>[2];</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		<span class="built_in">return</span> <span class="string">'找不到mac'</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">echo</span> getMac();</div><div class="line"><span class="built_in">exit</span>;</div><div class="line">  </div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<h3 id="三、云服务器使用情况"><a href="#三、云服务器使用情况" class="headerlink" title="三、云服务器使用情况"></a>三、云服务器使用情况</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">在（某里、某度、某腾）云服务器中执行 arp <span class="_">-a</span> 得到的映射记录并无最近的用户的访问ip，云服务器内部做了处理，所以无法获取到。</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/14/php/ffmpeg/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sir051223">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Forest">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/14/php/ffmpeg/" itemprop="url">linux suse安装ffmpeg及php使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-14T16:45:34+08:00">
                2018-12-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Php/" itemprop="url" rel="index">
                    <span itemprop="name">Php</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="一、获取ffmpeg"><a href="#一、获取ffmpeg" class="headerlink" title="一、获取ffmpeg"></a>一、获取ffmpeg</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget https://www.ffmpeg.org/releases/ffmpeg-4..tar.bz2</div></pre></td></tr></table></figure>
<h3 id="二、解压并编译安装"><a href="#二、解压并编译安装" class="headerlink" title="二、解压并编译安装"></a>二、解压并编译安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">tar -xjvf ffmpeg-4.0.tar.bz2</div><div class="line"></div><div class="line"><span class="built_in">cd</span> ffmpeg-4.0</div><div class="line"></div><div class="line">执行配置：./configure，此时或出现如下报错</div><div class="line"></div><div class="line">nasm/yasm not found or too old</div></pre></td></tr></table></figure>
<h3 id="三、参数值传输接收不到的情况"><a href="#三、参数值传输接收不到的情况" class="headerlink" title="三、参数值传输接收不到的情况"></a>三、参数值传输接收不到的情况</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">第一次传递的参数，在服务端接收参数正常，修改参数名后，给参数赋值，在服务端出现接收不到参数值的现象</div><div class="line"></div><div class="line">调试1：安装soapui，发起调用 -&gt; 调用正常  判断：排除服务器端问题</div><div class="line"></div><div class="line">调试2：将参数值修改为固定字符串值，再发起调用 -&gt; 依然接收不到 判断：排除参数赋值失效</div><div class="line"></div><div class="line">调试3：改变参数位置，再发起调用 -&gt; 依然接收不到  判断：排除参数位置影响</div><div class="line"></div><div class="line">调试4：删除runtime缓存文件，再发起调用 -&gt; 依然接收不到  判断：排除程序缓存文件影响</div><div class="line"></div><div class="line">调试5：重启apache或php-fpm，再发起调用 -&gt; 依然接收不到  判断：排除web服务器环境问题</div><div class="line"></div><div class="line">调试6：本地wamp环境，发起调用 -&gt; 接收正常  判断：soap环境差异问题导致，查找到是soap缓存的问题</div><div class="line"></div><div class="line">修改代码</div><div class="line"></div><div class="line"><span class="variable">$soap</span> = new \SoapClient(<span class="string">'http://www.whatever.com/WebService.asmx?wsdl'</span>);</div><div class="line"></div><div class="line">为</div><div class="line"></div><div class="line"><span class="variable">$soap</span> = new \SoapClient(<span class="string">'http://www.whatever.com/WebService.asmx?wsdl'</span>, array(<span class="string">'cache_wsdl'</span> =&gt; 0));</div><div class="line"></div><div class="line">发起调用 -&gt; 接收正常</div></pre></td></tr></table></figure>
<h3 id="五、总结"><a href="#五、总结" class="headerlink" title="五、总结"></a>五、总结</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">参数名接收到，但参数值接收不到，这很怪异，一开始没有怀疑缓存原因，归根到底是对soap的基础理解得不够深刻。使用排除法定位问题的</div><div class="line">速度还是比较局限。透过现象去了解程序的本质，设计思想，对于分析、解决问题有很大的帮助</div></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/13/manage/cultrue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sir051223">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Forest">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/13/manage/cultrue/" itemprop="url">良好的研发团队文化是怎样「长」成的</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-13T16:14:05+08:00">
                2018-12-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Manage/" itemprop="url" rel="index">
                    <span itemprop="name">Manage</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1、写在前面"><a href="#1、写在前面" class="headerlink" title="1、写在前面"></a>1、写在前面</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">转载来至：http://mp.weixin.qq.com/s/fzBDkwaJPzGUr2<span class="built_in">bg</span>0Th6IQ</div></pre></td></tr></table></figure>
<p>平时经常听到Google公司讲企业文化，阿里、华为讲价值观，总觉得很牛B，高大上的东西。几个字就成为公司的核心竞争力，我们能不能自己也搞一个呢？其实文化只是一种思想观念、行为习惯、处事风格，家有家风，国有国法，一个民族有一个民族的文化。寺庙文化传承千百年，舌尖上的美食流传至今，它应该有一个自己的发展规律。今天，我们一起来探讨一下，研发团队文化是怎么形成的，下面以我个人的经历来抛砖引玉。</p>
<p>我35岁前主要钻研技术，近几年逐步转向管理，带过几十人至一两百人的研发队伍。在最近的管理工作中，总结并归纳了几个可以贴到墙上的大字，即「共治分享自视一起拼，简单有效快」，接下来讲讲这14个字的来源。</p>
<h3 id="2、遇到的问题"><a href="#2、遇到的问题" class="headerlink" title="2、遇到的问题"></a>2、遇到的问题</h3><p>我一年多以前入职了现在的单位，以技术负责人的身份。到岗以后发现了不少的问题：</p>
<ol>
<li><p>技术差：架构臃肿，分层混乱，不利于维护和扩展；机房建设落后，有两个自建机房，故障处理没流程；</p>
</li>
<li><p>氛围差：团队没有活力，没有争论，没有学习和分享的氛围。准时上下班，人员懒散，没有激情，像一潭死水一样。不接受新事物，封闭自己，遇到问题相互推诿；</p>
</li>
<li><p>组织结构不合理：人员没有充分利用起来，造成资源浪费，团队角色职责定义模糊，整个团队没有一个清晰的目标和落地的步骤，成员相互的合作不协调。</p>
</li>
</ol>
<h3 id="3、解决之道"><a href="#3、解决之道" class="headerlink" title="3、解决之道"></a>3、解决之道</h3><p>有问题当然是解决问题，所有的问题本质上都是人的问题，空降的领导必然会导致一部分人员的流失，只要控制在一定的范围内即可。不是因为你不够好，只是因为他对过去领导的依恋，以及对新事物的不正面。改变一个人的成本，比招聘一个人的成本还要大。所以如果有人要离职，同意即可，让他优雅地离开，这是于公司于个人都是有利的事情。</p>
<p>解决了人的问题，接着是解决技术问题，组建架构部，引进一些优秀的人才，自己带几个项目，打两场硬仗，培养兄弟感情的同时，也是让大家认同你的最好方式。做完了这些，然后调整组织架构，实行弹性工作制，接下来就是日常的管理工作了。部门共治，搭建统一工作平台，树立新工作作风，搞氛围，激活团队，只能一步一步地来。</p>
<h4 id="a-部门共治"><a href="#a-部门共治" class="headerlink" title="a.部门共治"></a>a.部门共治</h4><p>部门共治就是部门要共同治理，我一直认为，每个人只要管好自己，部门的管理就简单得多。先在文件服务器上建一个文件夹，取名为部门共治，然后在里面新建如周报、周会纪要、工时统计、故障报告等目录。</p>
<p>1.周报，我个人一直有写周报的习惯，它是自我管理的方式。上一周总结、下一周计划，让自己有一个清晰的工作目标，理清事情的轻重缓急，同时透明化自己的工作，增加彼此的信任。先是自己写，然后分级逐步推广到全员。</p>
<p>2.工时统计，工时统计是每个月对团队工作时长的统计，由人事协助出报表。它统计到每个人、小组、部门的上班时长情况，主要通过疲劳指数、超出率、小组平均超出率、总平均超出率4个指数来体现。</p>
<p>一切以数据说话，增加人员要看小组平均超出率，员工累不累看疲劳指数，总平均超出率体现了整个部门的负荷情况，了解整个部门的工作节奏，也为增员或者裁员提供了参考指标，工时统计还可以与工单统计相结合。在具体操作时，需要注意可能产生的负面影响，如造成团队成员的反感、过度鼓励加班等，其实超出率过高或过低都不是很好的现象。</p>
<p>3.周会，管理小组每周碰一下，汇总一下工作和问题，同时提交会议纪要，全员都可以查看，并邮件方式同步给领导。我们的周会在每周一下午上班的第一时间，并要求开启午休关掉的灯，管理层从自己做起，严格约束自己，给大家立一个榜样，顺带还解决午休延迟开灯的问题。</p>
<p>早期的周会由我主持，后面轮流主持和记录。主持人站在部门负责人的角度，对汇报人员提出质疑或建议，这样就迫使站在整个研发中心的角度去思考，培养了每个人的全局观，减少本位主义和平时工作中不必要的冲突，同时还提高了管理人员的组织协调力。</p>
<p>4.故障分析报告，将故障分级管理，然后尽量透明化，重要故障全员通告，此工作由运维部门负责。故障报告不仅可追溯，也是一个总结分析的过程，可协助查找到根本问题。透明化可以提高大家的警惕，造成的损失也间接地告诉了代码与商业价值的关系。</p>
<p>5.书籍分享和书斋建设，如果要构建一个学习型团队，书籍的分享和书斋的建设是很好的办法。同时它相当于一面文化宣传墙，利于人员的招聘。书籍可以公司出钱购买，也可以鼓励大家捐赠、分享。书籍它本身很便宜，但真的要捐赠时也有不舍，所以鼓励大家离开时可赎回。捐赠和购书、以及分享书籍的过程，也是学习氛围养成的过程。</p>
<h4 id="b-搭平台，立作风"><a href="#b-搭平台，立作风" class="headerlink" title="b.搭平台，立作风"></a>b.搭平台，立作风</h4><p>搭工作平台，立新工作作风。没有度量就没有提升，管理要数据化、工具化。搭建统一的工作平台，提高大家的工作效率，同时还要树立新的工作作风，如站立式会议、周五分享日、项目管理工具和知识管理工具。</p>
<p>1、项目管理工具JIRA，引入JIRA项目管理工具，可以管理需求、工单、缺陷等各种任务。可以实时地监控、跟踪任务的状态，还可以在每月底出工单统计报告，评估开发人员的工作量和测试人员的工作量。</p>
<p>2、知识管理工具WIKI，类似于维基百科，主要用于知识的分享。可以创建部门的空间、自己个人的空间，写自己的工作心得、新的技术知识等。我个人的一些心得和重要邮件，我也会截图分享到自己的个人空间，这有利于新成员的了解和合作，也利于团队文化的形成。以前企业文化搞海报、杂志等方式，现在采用这种方式更容易接受，也更容易推广。</p>
<p>3、站立式会议，研发是一个需要创意，大脑密集性的工作。所以技术讨论是必不可少的部分，而站立式会议则是非常好的形式。小组周会或者几个人讨论一个问题，非常适合站立式短会。20分钟左右，大家站在白板前，不需要做会议记录，直接用手机拍照，会后发邮件或QQ群。简单高效快，大家保持专注，也不会懒洋洋的样子，没人会玩手机。因为站着，所以会议不会太长，高效、方便、随时随地，不一定需要会议室，所以研发中心要多一些白板，多一些小的会议室。</p>
<p>4、周五分享日，技术的分享现在已成为研发团队的标配，我们每周五是技术分享日，时间定在下午17点到19点，这样避免影响正常的工作。同时让大家知晓，成长不仅是团队的事情，也是个人的事情。分享有利于主讲人知识的巩固、总结，成果的展示，也有利于大家快速的学习。架构部的分享是工作的一部分，其它的则是自愿报名，自由组织。我们的分享也要采用简单有效快的方式，鼓励直接show代码，或使用wiki来讲，这样也利于二次传播，不一定要高大上，也不一定要PPT，达到目的和起到效果即好。</p>
<h4 id="c-搞氛围，激活团队"><a href="#c-搞氛围，激活团队" class="headerlink" title="c.搞氛围，激活团队"></a>c.搞氛围，激活团队</h4><p>工作和生活要平衡，认真工作，快乐生活。如果管理是鞭策或大棒，那么领导就是鼓励或葫芦卜。季度会议、乐捐与周四下午茶、户外兴趣小组是搞氛围、激活团队的很好方式。</p>
<p>1、季度会议，周会说事，季度会议谈情怀。每3个月左右开一次季度会，套路是新人介绍，上季度的总结，下季度的计划，其它如新书推荐、特长展示等。新人介绍可以快速地融入整个部门，感受团队的热情。上季度的工作总结和下季度的计划，是每个部门长向下级汇报，我们鼓励上级向下级定期汇报，总理都要每年向全国人民汇报，我们也要这样，让每个人都知道各小组最近在干些什么事，下阶段要做什么，设置一个共同的目标，然后一起拼搏。新书推荐，主持人会向大家介绍近期自己读过的书，以及读书的感悟与心得，一起成长。</p>
<p>季度会议如同年度会议，年会不开会，只是吃吃喝喝，以及节目表演，所以季度会议的形式也要比较轻松，以乐观向上的氛围为主，参与的人数比较多。我们的季度会议采用轮值，每次的风格都不一样，这样挺好的，也非常锻炼主持人的组织协调能力，会议时间一般占用周五分享日的时间。</p>
<p>2、乐捐与周四下午茶，乐捐是一个自罚约定、一个问责制度，让员工敢于担当。对于开会迟到、系统小故障、乐捐10元能够起到很好的作用。惩罚只是手段，改进才是目的，培养承担责任的习惯，每次出现问题，都有人站出来承担责任。可别小瞧10元，10元只是最低额，额度自定，乐捐它是一个很好的追责方式，故障更容易明确主要责任人。明确责任后，个人自愿，如果你不愿意10至50元，则由他的直接领导来承担，这是一种社区式的潜在力量。</p>
<p>乐捐不可强制，如会议迟到了你不愿意承担，那便需要由会议主持人承担。乐捐的钱会汇入到部门基金，用于部门的下午茶。我们每周举办一次下午茶，周四进行，因为周一是例会日、周二是发布日、周三无会议日、周五又是分享会。下午茶给大家一个轻松的时间，促进交流，营造气氛，费用由个人乐捐、项目经费共同组成。</p>
<p>3、户外活动兴趣小组，工作生活Balance，兴趣小组能够促进大家的交流，非正式的沟通能改善大家的关系，增强团队的凝聚力。我们组建了羽毛球兴趣小组、户外徒步兴趣小组，以及参与公司的年会表演，组织形式是开放的，是弱化了公司和部门信息的QQ群。兴趣小组有利于业务与技术的融合、跨部门沟通，大家劳逸结合，一起爬山一起拼。</p>
<h4 id="d-更多管理工具"><a href="#d-更多管理工具" class="headerlink" title="d.更多管理工具"></a>d.更多管理工具</h4><p>当然不仅仅是以上，我们每一个管理工具都是针对当前的问题，推行2至4周，一个阶段仅推广一个管理工具。我们尝试并留下来的管理工具总共有20多个，具体有：“周会周报、弹性工作制、技术分享会、季度会议、下午茶、10元自罚约定、白板前站立式会议、技术评审制度、会议轮流主持制度、书斋建设、项目管理制度的推行、项目奖金申报制度、招聘比自己更优秀人的约定、末尾淘汰约定、鼓励争论、跨部门沟通约定、源代码统一管理、Y盘文档管理、JIRA和WIKI研发管理工具推广、羽毛球兴趣小组、户外爬山兴趣小组、个体绽放，周一例会日、周二发布日、周三无会议日、周四下午茶、周五分享日”。</p>
<h3 id="4、总结与提升"><a href="#4、总结与提升" class="headerlink" title="4、总结与提升"></a>4、总结与提升</h3><p>太阳底下没有新鲜事，这些工具或措施，或多或少都知道些，我们只是把它落地贯彻，形成了一定的体系。我们的团队一步一步往前走，确实越来越好。这时不断有新人加入，如何将这过去一年多的想法和做法都留下来，并传达出去呢？我们需要把它浓缩成几个字才好，这就是前面提到的“共治分享自视一起拼，简单有效快”，具体内容如下：</p>
<p>共治：共治就是部门要共同治理，自我管理和部门管理一起进行，每个人要管好自己，部门的共治我们希望能转化为个人的自治。具体形式有部门共治文件夹、轮值会议等；</p>
<p>分享：因为专业所以自信，因为自信所以开放，因为开放所以分享。具体形式有周五分享日、书斋建设；</p>
<p>自视：自视就是自我察觉，双眼反向注视着自己。对公司和他人的要求转化为对自己的要求，少一些抱怨，多找一些方法，如乐捐；</p>
<p>一起拼：一起拼就是团队要一起拼搏，一起奋斗，一起喝酒、一起爬山，如户外、项目管理；</p>
<p>简单有效快：把复杂的事情变简单，追求事物的本质，这就是简单有效。“快”是指快速地交付，快速响应业务的需求，如站立式会议等。</p>
<p>以上是我们近一年的总结和实践，也许它并不完美，但它还是能表达团队之前及现阶段的一些行为。当我们确定了这个阶段的部门文化后，团队氛围有了较大的改善，从死气沉沉到激情活力，从固步自封到好学分享，从互相推诿到勇于担当。在后期的几个大项目中，项目的成功显得自然得多，特别在新员工的融合上，成本也低得多。</p>
<h3 id="5、「长」出来的团队文化"><a href="#5、「长」出来的团队文化" class="headerlink" title="5、「长」出来的团队文化"></a>5、「长」出来的团队文化</h3><p>可能现在你已发现，原来文化的构建并没有想象地那么难，也没有多少高大上。它也需要脚踏实地、土里吧唧，一步一步埋头干。先有管理工具、制度和行为措施，然后予以贯彻，形成一种习惯，最后才是总结提升。</p>
<p>我们不能简单的参考大公司的做法，或者管理书籍上挑选几个词语，然后领导喊两声或挂在墙上。这个过程就如同花朵或生物一般，需要播种、栽培，然后才能收获。这样「长」出来的文化，才能管人做事，深入骨髓、改变思想，才能成为公司或团队的核心竞争力。以上浅见，希望能给你一些参考，当然，你也可以尝试一把，just do it!</p>
<h3 id="6、作者介绍"><a href="#6、作者介绍" class="headerlink" title="6、作者介绍"></a>6、作者介绍</h3><p>张辉清，中青易游CTO，曾就职于携程架构、古大集团，在古大集团任首席架构师和高级技术总监。现阶段关注技术与业务的融合、工程效率和团队管理。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/24/essay/recruit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sir051223">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Forest">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/24/essay/recruit/" itemprop="url">阿里技术面试的思路（转载）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-24T16:31:12+08:00">
                2018-10-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/随笔/" itemprop="url" rel="index">
                    <span itemprop="name">随笔</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="阿里技术面试的思路"><a href="#阿里技术面试的思路" class="headerlink" title="阿里技术面试的思路"></a>阿里技术面试的思路</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">转载说明：阿里技术面试思路，转载来至阿里技术公众号，原创宗心，以借鉴面试筛选人才想法，如有冒犯之处，</div><div class="line"></div><div class="line">请告知，我会第一时间删除，谢谢。</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">阿里妹导读：知己知彼、百战不殆，面试也是如此。只有充分了解面试官的思路，才能更好地在面试中充分展现自己。</div><div class="line"></div><div class="line">今天，阿里高级技术专家将分享自己作为面试官的心得与体会。如果你是面试者，可以借此为镜，对照发现自己的长处与不足，</div><div class="line"></div><div class="line">有针对性学习成长；如果你是面试官，相信也能通过他的讲述，有所启发。</div></pre></td></tr></table></figure>
<p>招聘是团队管理者工作中的重要一环。本文会结合自己亲身经历以及接受的招聘培训，综合分析怎么找到我们要的人，也希望可以通过招聘这面镜子照亮自己，怎样成为一个更好的工程师。</p>
<h3 id="1-招聘的目的"><a href="#1-招聘的目的" class="headerlink" title="1.招聘的目的"></a>1.招聘的目的</h3><p>当今社会，技术已经成为影响商业成功的关键因素，工程师成为了这些公司最宝贵的财富，没有优秀的人组成团队来完成商业目标，公司根本不可能有今天的成就。所以招聘，就是选择最优秀的人。</p>
<h3 id="2-招什么样的人？"><a href="#2-招什么样的人？" class="headerlink" title="2.招什么样的人？"></a>2.招什么样的人？</h3><p>招优秀的人显然是一个很模糊的概念，我们来度量的时候，我个人认为三个因素是最关键的：</p>
<h4 id="a-技能"><a href="#a-技能" class="headerlink" title="a.技能"></a>a.技能</h4><p>工作项目经验，以及解决疑难问题的能力，毕竟招来的人首先必须很好的完成工作，这是最基本的要求，注意，是很好的完成，不是仅仅完成。</p>
<h4 id="b-潜力"><a href="#b-潜力" class="headerlink" title="b.潜力"></a>b.潜力</h4><p>这个概念看起来比较模糊，其实还是比较容易评价的，对计算机相关的专业的知识体系是不是完整，基础是不是扎实，平常是不是喜欢钻研，对这个世界充满好奇心，这几年走下来，沉淀的速度如何，都是判断一个人的潜力的方式，注意我们看潜力主要是基于候选人的之前的成长经历实事求是来看，过去的优秀经历才能给未来背书。潜力和技能的重要性一样重要，我们不能只看眼前，团队是需要不断发展和前进的，所以我们招人应该面向未来。</p>
<h4 id="c-软实力"><a href="#c-软实力" class="headerlink" title="c.软实力"></a>c.软实力</h4><p>软实力这里其实包含了性格，执行力，领导力等方方面面，它代表了候选人是否能快速融入团队，拿到结果，带领团队攻城拔寨，激励和影响身边的人变得更加优秀等等，软实力一般HR肯定会考察，虽然技术面不会特别去关注，但是从面试的过程中可以看出候选人的沟通能力，以及性格相关的特点，也值得我们注意。</p>
<p>说了这么多，其实在招人上有一个对比的标杆，就是你招的人是不是比团队中同一等级中50%的同学优秀，如果你觉得没有他们优秀，那不用纠结，这个候选人不要了，团队必须不停加入更好的同学，才能变得更加强大。</p>
<h3 id="3-面试的方法"><a href="#3-面试的方法" class="headerlink" title="3.面试的方法"></a>3.面试的方法</h3><p>这里结合之前的培训以及自己的真实经历，讲解面试的一些方法。</p>
<h4 id="a-面试不要做的事"><a href="#a-面试不要做的事" class="headerlink" title="a.面试不要做的事"></a>a.面试不要做的事</h4><h6 id="问一些知道性的问题比如问知不知道这个API干什么的，怎么调用，这个命令怎么用的，知道性的知识，google一下或者认真看下文档就应该知道。"><a href="#问一些知道性的问题比如问知不知道这个API干什么的，怎么调用，这个命令怎么用的，知道性的知识，google一下或者认真看下文档就应该知道。" class="headerlink" title="问一些知道性的问题比如问知不知道这个API干什么的，怎么调用，这个命令怎么用的，知道性的知识，google一下或者认真看下文档就应该知道。"></a>问一些知道性的问题比如问知不知道这个API干什么的，怎么调用，这个命令怎么用的，知道性的知识，google一下或者认真看下文档就应该知道。</h6><h6 id="问一些特别复杂的问题比如问一个特别复杂的算法，问一个很抽象的大问题，短时间内很难给予回答。"><a href="#问一些特别复杂的问题比如问一个特别复杂的算法，问一个很抽象的大问题，短时间内很难给予回答。" class="headerlink" title="问一些特别复杂的问题比如问一个特别复杂的算法，问一个很抽象的大问题，短时间内很难给予回答。"></a>问一些特别复杂的问题比如问一个特别复杂的算法，问一个很抽象的大问题，短时间内很难给予回答。</h6><h6 id="问一些假设性的问题假设你参与了这个项目，你觉得哪几个地方需要优化。"><a href="#问一些假设性的问题假设你参与了这个项目，你觉得哪几个地方需要优化。" class="headerlink" title="问一些假设性的问题假设你参与了这个项目，你觉得哪几个地方需要优化。"></a>问一些假设性的问题假设你参与了这个项目，你觉得哪几个地方需要优化。</h6><p>之所以说这些问题不应该问，我认为主要是因为这些很难考察到面试者的真实能力，45分钟的时间本来就很短，有些问题有可能比较偏，有些问题又过于庞大没法一下子描述特别清楚，还有一些问题缺乏上下文，让人摸不到头脑，所以尽量避免这么问问题，另外把握一个重要原则，不要在面试中试图证明别人不如自己，毫无意义，人无完人，总有覆盖不到的地方，按照这个规则招聘，会错过很多优秀的人才。</p>
<h4 id="b-面试应该做的事"><a href="#b-面试应该做的事" class="headerlink" title="b.面试应该做的事"></a>b.面试应该做的事</h4><h6 id="问已经发生的事情"><a href="#问已经发生的事情" class="headerlink" title="问已经发生的事情"></a>问已经发生的事情</h6><p>比如面试移动开发者，面试官应该认真看下其做过的App，具体的工作是什么，准备一些相关的问题，这里就可以看出来之前工作中的积累是什么，有多深。</p>
<h6 id="问题解决思路"><a href="#问题解决思路" class="headerlink" title="问题解决思路"></a>问题解决思路</h6><p>针对项目经验和一些学习的经验上面，应该问拿到问题以后解决思路是什么，在什么场景下为什么这么做，这里根据面试者的方案，分析的方法论，就可以大致了解面试者是否聪明，知识面是不是够广，遇到问题时会不会举一反三。</p>
<p>具体可以举个简单的例子，很多同学说自己做过架构，然后都会讲自己做了一个解耦和分层的框架，其实这类框架iOS很多，外部github上就有各种方案。在阿里内部手淘早先做的bundle拆分时沉淀的容器规则，天猫开源出去的beeHive，闲鱼内部的Xframework，抑或是服务端的spring mvc，其实都实现了IoC，但实现和思路上都有一些差异，到底为什么这么做，其实是有区别的，这里面就可以看出知识广度，总结和思辩能力，在关键路径上的技术判断。</p>
<p>又比如说，我们总在强调性能稳定性怎么做，业界也有很多方案，到底哪个方案更好呢？答案没有绝对的对错，取决于某个时间点和场景下哪个问题是最核心的突破点，而你的选择标准和落地的技术方案是不是合理（考虑成本，收益，以及后续的风险是什么）。一般来讲，我们更倾向于用系统化的思维看待一个问题，也就是说，相比根据人的经验去识别性能瓶颈，我们更希望能通过自动化，智能化，数据化的方式去解决问题。</p>
<h4 id="c-少问多听"><a href="#c-少问多听" class="headerlink" title="c.少问多听"></a>c.少问多听</h4><p>一般刚开始做面试官的同学很喜欢以问为主，但因为大家的知识体系不太一样，成长环境也不同，直接这么问起来很难就找到面试者的优点，所以尽量让应试者自己陈述，然后以学习和交流的心态针对陈述中存疑的地方再进行发问，会更容易让应试者放松，也更容易让应试者更全面的表达自己。另外，问的差不多的时候，结尾的时候可以补充一句：您觉得刚才的面试中还有哪些我没问到的，您想再补充一下的内容？末了，再问下：我的问题问完了，您有什么想要问我的吗？</p>
<p>知道了应该怎么做，那具体的提问方法有没有什么技巧呢？在招聘中有一个重要的STAR原则，可以跟大家分享。</p>
<h3 id="4-STAR原则"><a href="#4-STAR原则" class="headerlink" title="4.STAR原则"></a>4.STAR原则</h3><h6 id="处境-situation"><a href="#处境-situation" class="headerlink" title="处境(situation)"></a>处境(situation)</h6><p>在什么样的环境下</p>
<h6 id="任务-task"><a href="#任务-task" class="headerlink" title="任务(task)"></a>任务(task)</h6><p>接到了什么样的任务</p>
<h6 id="行动-action"><a href="#行动-action" class="headerlink" title="行动(action)"></a>行动(action)</h6><p>然后具体怎么落地的</p>
<h6 id="结果-result"><a href="#结果-result" class="headerlink" title="结果(result)"></a>结果(result)</h6><p>拿到了什么结果</p>
<p>我们尽量问清楚对方在什么样的环境下接到这个任务，接到以后是做了什么事情，最后的结果是什么样子的。乍一听，感觉，这不是套路嘛，是不是知道这个原则的人，只要按照这四点编故事，就能通过面试了？当然不是，在叙述过程中，我们应该分辨出STAR中的真假，那下面就举一些例子。</p>
<h3 id="5-假的STAR"><a href="#5-假的STAR" class="headerlink" title="5.假的STAR"></a>5.假的STAR</h3><h6 id="描述含糊不清"><a href="#描述含糊不清" class="headerlink" title="描述含糊不清"></a>描述含糊不清</h6><p>比如，我用这个方案解决了这个问题，效果很好，得到了大家的一致好评。注意，效果好是哪里好，有什么度量的标准？一致好评的体现是在具体KPI还是比如团队有个什么奖励之类的。</p>
<h6 id="只表达态度和看法"><a href="#只表达态度和看法" class="headerlink" title="只表达态度和看法"></a>只表达态度和看法</h6><p>我觉得线上稳定性非常重要，应该重点解决和持续跟进。如果只有这一句话，没有后面具体认为重要的解决方案的话，这部分的经验难以令人信服。</p>
<h6 id="假设式描述"><a href="#假设式描述" class="headerlink" title="假设式描述"></a>假设式描述</h6><p>如果我来做这件事情，我会1234怎么怎么样。前面其实面试应该问的问题里面有提到，我们本身就不应该问假设性的问题，那作为面试者，假设没做过的事情，如果只是看思路还好，但是如果说的天花乱坠，这个时候要警惕了，毕竟说和做之前的差异是很大的。对于假设的事情，面试官是没法评估具体效果的，因为它不像过去已有的项目和工作内容，是有明显结果的，如果对过去结果存疑，后续也可以背调了解具体的情况。</p>
<p>针对假的STAR，我们要甄别分辨出来，引导其表达出真正的情况。</p>
<h3 id="6-鉴别方式"><a href="#6-鉴别方式" class="headerlink" title="6.鉴别方式"></a>6.鉴别方式</h3><h6 id="更多的关心What-How-Why"><a href="#更多的关心What-How-Why" class="headerlink" title="更多的关心What/How/Why"></a>更多的关心What/How/Why</h6><p>做了什么事情，具体做的方案1234几步，为什么要这么做，比如图片的优化，最早肯定什么都没有，后续加cache，cache策略又可以升级，包括cache本身的算法以及多级cache的实现，图片尺寸上面后来有做了什么裁切之类的，图片格式上面后续又做了优化等等。</p>
<p>每个阶段不太一样，关注的重点也不一样，刨根问题问一问，会了解是不是真的做过这件事情，另外有一些可能项目做得很久说很多东西忘了，这里我分享一个观点，之前看过一句话，招聘的人中有一种人是比较好的，他总能比较清楚的记住过往项目当中的重点，这样的人在经验沉淀的过程中肯定更快一些，当然这样的同学肯定得归结在聪明一类的人了，当然能记住也说明他可能喜欢总结和回顾，平常的学习习惯应该也比较好。</p>
<h6 id="细节！细节！细节！"><a href="#细节！细节！细节！" class="headerlink" title="细节！细节！细节！"></a>细节！细节！细节！</h6><p>很多关键节点的细节很重要，比如网络库的优化。如果你是一个iOS开发，一般都会知道iOS的网络协议优化常采用拦截NSURLProtocol的方式进行，然后针对传统的https协议我们会将其替换成为spdy协议或者http2协议，过程中还有一些httpdns等的优化。但如果你今天希望招聘一个有这部分网络优化经验的同学，怎么判断这个同学有实操的经验呢？你可以让他说细节上面的很多事情，比如说URLProtocol拦截request以后，针对不同的case的降级策略是什么，选择依据是什么？当时遇到了什么其他的坑没有？你自己的做法有什么缺陷？</p>
<p>又比如Weex的实现上面，整个渲染的流程到底是怎样的，渲染部分还有什么优化空间吗？或者说这个方案本身做了哪方面的优化？它的配套工程体系上的问题是什么，你遇到以后是怎么解决掉的，这些在了解大概思路后，都可以往深入再问一下细节的部分，认真研读以及修改过代码的同学，肯定是答得出来的。</p>
<h3 id="7-其他Tips"><a href="#7-其他Tips" class="headerlink" title="7.其他Tips"></a>7.其他Tips</h3><h6 id="你在面试别人，别人也在选择你"><a href="#你在面试别人，别人也在选择你" class="headerlink" title="你在面试别人，别人也在选择你"></a>你在面试别人，别人也在选择你</h6><p>面试是双向的，面试官是一个团队对外的门面，不要迟到，提问和交流要尊重面试者，让面试者感受到我们的真诚。</p>
<h6 id="为未来招聘而不是现在"><a href="#为未来招聘而不是现在" class="headerlink" title="为未来招聘而不是现在"></a>为未来招聘而不是现在</h6><p>我们永远应该为未来招聘，因为招聘的人入职也是发生在未来，不能立刻就解决你眼前的问题，所以我们招聘的时候也放长远一点，招为团队未来更有好处的人。</p>
<h6 id="面试是一面镜子"><a href="#面试是一面镜子" class="headerlink" title="面试是一面镜子"></a>面试是一面镜子</h6><p>以人为镜，优秀的面试者给我们能带来新的思路和新的方法，而差强人意的面试者则提高我们看人的能力，为后续的提升招聘效率找到更正确的人打下基础。</p>
<h3 id="8-技术人如何不断成长？"><a href="#8-技术人如何不断成长？" class="headerlink" title="8.技术人如何不断成长？"></a>8.技术人如何不断成长？</h3><p>招聘，培训，人才选拔晋升，我认为评价标准和方法都应该有比较多的重合的部分，我们从刚才的面试经验中，反思下，如果现在是我们去找工作，这个市场或者团队更需要什么样的人？</p>
<h6 id="经验丰富，知识体系完整"><a href="#经验丰富，知识体系完整" class="headerlink" title="经验丰富，知识体系完整"></a>经验丰富，知识体系完整</h6><p>经验能解决实际的问题，另外知识体系可以让你在遇到新的问题时举一反三，当然大公司和小公司要求的知识体系又不太一样，大公司更偏向一专多能的T型人才，小公司更喜欢全栈，所以到底要成为什么样的人，跟你的职业规划很有关系，是想在大公司成就一番事业，还是出去闯荡，那你点的技能树肯定是不一样的。到底应该怎么做，我自己的经验是，找到身边的标杆，向更优秀的同学学习，在阿里当然非常优秀的专业人才也好，架构师也好，都非常多，所以标杆应该也好找，业界当然也有很多成功的人，有了标杆，就努力向上吧。</p>
<h6 id="保持良好的习惯，不忘总结和提升"><a href="#保持良好的习惯，不忘总结和提升" class="headerlink" title="保持良好的习惯，不忘总结和提升"></a>保持良好的习惯，不忘总结和提升</h6><p>当我还是一个菜鸟的时候，当时的老板问了我一个问题，每周写周报的时候，想想自己这一周到底收获了什么，这给我留下了很深的印象。我在想，既然我每次面试别人都问你最近有研究什么新的技术或者看到什么有趣的文章没有的，那我自己是不是能这样要求自己呢？不积跬步无以至千里，贵在坚持积累。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/24/sql/optimization/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sir051223">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Forest">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/24/sql/optimization/" itemprop="url">MySQL性能优化之参数配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-24T15:19:49+08:00">
                2018-10-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Sql/" itemprop="url" rel="index">
                    <span itemprop="name">Sql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-目的"><a href="#1-目的" class="headerlink" title="1.目的"></a>1.目的</h3><p>  通过根据服务器目前状况，修改Mysql的系统参数，达到合理利用服务器现有资源，最大合理的提高MySQL性能</p>
<h3 id="2-服务器参数"><a href="#2-服务器参数" class="headerlink" title="2.服务器参数"></a>2.服务器参数</h3><p>  32G内存、4个CPU,每个CPU 8核</p>
<p>  centos 7</p>
<h3 id="3-修改MySQL配置"><a href="#3-修改MySQL配置" class="headerlink" title="3.修改MySQL配置"></a>3.修改MySQL配置</h3><p>打开MySQL配置文件my.cnf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi  /etc/my.cnf</div></pre></td></tr></table></figure>
<p>修改back_log参数值:由默认的50修改为500</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">back_log=500</div></pre></td></tr></table></figure>
<p>修改back_log参数值:由默认的50修改为500</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">back_log=500 </div><div class="line"></div><div class="line">back_log值指出在MySQL暂时停止回答新请求之前的短时间内多少个请求可以被存在堆栈中。</div></pre></td></tr></table></figure>
<p>修改wait_timeout参数值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">wait_timeout=1800（单位为妙）</div><div class="line"></div><div class="line">wait_timeout是MySQL客户端的数据库连接闲置最大时间值。</div></pre></td></tr></table></figure>
<p>修改max_connections参数值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">max_connections=3000（单位为妙）</div><div class="line"></div><div class="line">max_connections是指MySql的最大连接数，如果服务器的并发连接请求量比较大，建议调高此值，以增加并行连接数量</div></pre></td></tr></table></figure>
<p>修改max_user_connections值，由默认的0，修改为800</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">max_user_connections=800</div><div class="line"></div><div class="line">max_user_connections是指每个数据库用户的最大连接，设置为0表示不限制</div></pre></td></tr></table></figure>
<p>修改thread_concurrency值，由目前默认的8，修改为64</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">thread_concurrency=64</div><div class="line"></div><div class="line">thread_concurrency应设为CPU核数的2倍. 比如有一个双核的CPU, 那thread_concurrency  </div><div class="line"></div><div class="line">的应该为4; 2个双核的cpu, thread_concurrency的值应为8.</div></pre></td></tr></table></figure>
<p> default-storage-engine(设置MySQL的默认存储引擎)</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">default-storage-engine= InnoDB(设置InnoDB类型，另外还可以设置MyISAM类型)</div></pre></td></tr></table></figure>
<h3 id="4、demo示例"><a href="#4、demo示例" class="headerlink" title="4、demo示例"></a>4、demo示例</h3><p>[mysqld]<br>basedir      = path          # 使用给定目录作为根目录(安装目录)。<br>datadir      = path          # 从给定目录读取数据库文件。<br>pid-file     = filename      # 为mysqld程序指定一个存放进程ID的文件(仅适用于UNIX/Linux系统);</p>
<p>socket = /tmp/mysql.sock     # 为MySQL客户程序与服务器之间的本地通信指定一个套接字文件(Linux下默认是/var/lib/mysql/mysql.sock文件)<br>port             = 3306      # 指定MsSQL侦听的端口<br>key_buffer       = 384M      # key_buffer是用于索引块的缓冲区大小，增加它可得到更好处理的索引(对所有读和多重写)。<br>                               索引块是缓冲的并且被所有的线程共享，key_buffer的大小视内存大小而定。<br>table_cache      = 512       # 为所有线程打开表的数量。增加该值能增加mysqld要求的文件描述符的数量。可以避免频繁的打开数据表产生的开销<br>sort_buffer_size = 2M        # 每个需要进行排序的线程分配该大小的一个缓冲区。增加这值加速ORDER BY或GROUP BY操作。<br>                               注意：该参数对应的分配内存是每连接独占！如果有100个连接，那么实际分配的总共排序缓冲区大小为100×6=600MB<br>read_buffer_size = 2M        # 读查询操作所能使用的缓冲区大小。和sort_buffer_size一样，该参数对应的分配内存也是每连接独享。<br>query_cache_size = 32M       # 指定MySQL查询结果缓冲区的大小<br>read_rnd_buffer_size    = 8M # 改参数在使用行指针排序之后，随机读用的。<br>myisam_sort_buffer_size = 64M # MyISAM表发生变化时重新排序所需的缓冲<br>thread_concurrency      = 8  # 最大并发线程数，取值为服务器逻辑CPU数量×2，如果CPU支持H.T超线程，再×2<br>thread_cache            = 8  # #缓存可重用的线程数<br>skip-locking                 # 避免MySQL的外部锁定，减少出错几率增强稳定性。</p>
<p>[mysqldump]<br>max_allowed_packet     = 16M # 服务器和客户端之间最大能发送的可能信息包</p>
<p>[myisamchk]<br>key_buffer   = 256M<br>sort_buffer = 256M<br>read_buffer = 2M<br>write_buffer = 2M</p>
<p>back_log = 384</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/23/sql/install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sir051223">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Forest">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/23/sql/install/" itemprop="url">centos7下源码编译安装mysql5.6最新版本</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-23T18:25:12+08:00">
                2018-10-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Sql/" itemprop="url" rel="index">
                    <span itemprop="name">Sql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-检查-MySQL-是否已安装"><a href="#1-检查-MySQL-是否已安装" class="headerlink" title="1.检查 MySQL 是否已安装"></a>1.检查 MySQL 是否已安装</h3><p>  yum list installed | grep mysql<br>  如果有，就先全部卸载，命令如下：<br>  yum -y remove mysql-libs.x86_64<br>  若有多个依赖文件则依次卸载。当结果显示为 Complete！即卸载完毕。</p>
<h3 id="2-依赖安装"><a href="#2-依赖安装" class="headerlink" title="2.依赖安装"></a>2.依赖安装</h3><p>  MySQL 依赖 libaio，所以先要安装 libaio<br>  yum search libaio  # 检索相关信息<br>  yum install libaio # 安装依赖包</p>
<h3 id="3-下载-MySQL-Yum-Repository"><a href="#3-下载-MySQL-Yum-Repository" class="headerlink" title="3.下载 MySQL Yum Repository"></a>3.下载 MySQL Yum Repository</h3><p>wget <a href="http://dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm" target="_blank" rel="external">http://dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm</a><br>  如果提示-bash: wget: 未找到命令，请先执行 yum install wget 安装 wget</p>
<h3 id="4、安装"><a href="#4、安装" class="headerlink" title="4、安装"></a>4、安装</h3><p>  添加 MySQL Yum Repository<br>  添加 MySQL Yum Repository 到你的系统 repository 列表中，执行<br>  yum localinstall mysql-community-release-el7-5.noarch.rpm<br>  提示是否 OK ，输入 y</p>
<p>  验证下是否添加成功<br>  yum repolist enabled | grep “mysql.<em>-community.</em>“</p>
<p>  选择要启用 MySQL 版本<br>  查看 MySQL 版本，执行<br>  yum repolist all | grep mysql<br>  可以看到 5.5， 5.7 版本是默认禁用的，因为现在最新的稳定版是 5.6</p>
<p>  yum repolist enabled | grep mysql 查看当前的启动的 MySQL 版本</p>
<p>  通过 Yum 来安装 MySQL<br>  yum install mysql-community-server<br>  遇到上述提示，输入 y 继续，执行完成会提示“完毕！”。此时MySQL 安装完成，<br>  它包含了 mysql-community-server、mysql-community-client、mysql-community-common、mysql-community-libs 四个包。</p>
<p>  执行 whereis mysql 可以看到 MySQL 的安装目录是 /usr/bin/</p>
<h3 id="5、启动和关闭-MySQL-Server"><a href="#5、启动和关闭-MySQL-Server" class="headerlink" title="5、启动和关闭 MySQL Server"></a>5、启动和关闭 MySQL Server</h3><p>  启动 MySQL Server<br>  systemctl start  mysqld</p>
<p>  查看 MySQL Server 状态<br>  systemctl status  mysqld</p>
<p>  关闭 MySQL Server<br>  systemctl stop mysqld</p>
<h3 id="6、防火墙设置"><a href="#6、防火墙设置" class="headerlink" title="6、防火墙设置"></a>6、防火墙设置</h3><p>  远程访问 MySQL， 需开放默认端口号 3306<br>  firewall-cmd方式<br>  firewall-cmd –permanent –zone=public –add-port=3306/tcp<br>  firewall-cmd –permanent –zone=public –add-port=3306/udp</p>
<h3 id="7、MySQL-安全设置"><a href="#7、MySQL-安全设置" class="headerlink" title="7、MySQL 安全设置"></a>7、MySQL 安全设置</h3><p>  服务器启动后，可以执行<br>  mysql_secure_installation;<br>  此时输入 root 原始密码（初始化安装的话为空），接下来，为了安全，MySQL 会提示你重置 root 密码，移除其他用户账号，<br>  禁用 root 远程登录，移除 test 数据库，重新加载 privilege 表格等，你只需输入 y 继续执行即可。</p>
<h3 id="8、远程访问设置"><a href="#8、远程访问设置" class="headerlink" title="8、远程访问设置"></a>8、远程访问设置</h3><p>  创建一个普通用户 sa ，密码是 some_pass<br>  CREATE USER ‘zalocal’@’%’ IDENTIFIED BY ‘zhian@local#’;<br>  给这个用户授予 SELECT,INSERT,UPDATE,DELETE 的远程访问的权限，这个账号一般用于提供给实施的系统访问<br>  GRANT SELECT,INSERT,UPDATE,DELETE ON <em>.</em> TO ‘zalocal’@’%’;</p>
<p>  创建一个管理员用户 admin 账号 ，密码是 some_pass<br>  CREATE USER ‘admin’@’%’ IDENTIFIED BY ‘some_pass’;<br>  给这个用户授予所有的远程访问的权限。这个用户主要用于管理整个数据库、备份、还原等操作。<br>  GRANT ALL  ON <em>.</em> TO ‘admin’@’%’;</p>
<p>  使授权立刻生效<br>  flush privileges;</p>
<h3 id="9、更改数据存放目录"><a href="#9、更改数据存放目录" class="headerlink" title="9、更改数据存放目录"></a>9、更改数据存放目录</h3><p>  创建数据存放目录<br>  home 目录下建立 data 目录<br>  mkdir /opt/data</p>
<p>  把 MySQL 服务进程停掉<br>  如果 MySQL 是启动的，要先关闭<br>  mysqladmin -u root -p shutdown<br>  systemctl stop mysqld</p>
<p>  移动数据到数据存放目录<br>  /var/lib/mysql 整个目录移到 /opt/data，执行<br>  mv /var/lib/mysql /opt/data</p>
<p>  这样就把 MySQL 的数据文件移动到了 /opt/data/mysql 下</p>
<p>  修改 /etc/my.cnf 文件，</p>
<p>#########################################<br>  [mysqld]<br>  datadir=/home/data/mysql<br>  socket=/home/data/mysql/mysql.sock</p>
<p>  [mysql]<br>  socket=/home/data/mysql/mysql.sock</p>
<p>#########################################<br>  修改文件夹权限<br>  chown -R mysql:mysql /home/data/mysql</p>
<p>  重启后，如果不能启动 MySQL 服务，执行<br>  vi  /etc/sysconfig/selinux<br>  调整<br>  SELINUX=permissive 调整为宽松模式<br>  保存设置，执行 reboot 重启生效</p>
<h3 id="10、开机自起服务"><a href="#10、开机自起服务" class="headerlink" title="10、开机自起服务"></a>10、开机自起服务</h3><p>  查看 MySQL 服务是否开机启动<br>  systemctl is-enabled mysql.service;echo $?<br>  如果是 enabled 则说明是开机自动，如果不是，执行<br>  chkconfig –levels 235 mysqld on</p>
<h3 id="11、设置字符集"><a href="#11、设置字符集" class="headerlink" title="11、设置字符集"></a>11、设置字符集</h3><p>  一般的，为了支持中文，我们应该讲字符集设为 UTF-8， 在mysql控制台执行<br>  SHOW VARIABLES LIKE ‘character%’;<br>  查看当前 MySQL 字符集</p>
<p>  可以看到默认服务器的字符器是 latin1 ，对中文不友好。<br>  修改 /etc/my.cnf 文件，添加字符集的设置</p>
<p>##########################################################<br>  [mysqld]<br>  character_set_server = utf8</p>
<p>  [mysql]<br>  default-character-set = utf8</p>
<p>##########################################################</p>
<p>  重启 MySQL ,可以看到字符集已经修改了<br>  SHOW VARIABLES LIKE ‘character%’</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/23/linux/php/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sir051223">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Forest">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/23/linux/php/" itemprop="url">centos7下源码编译安装php7.1最新版本</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-23T16:21:55+08:00">
                2018-10-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-安装前准备"><a href="#1-安装前准备" class="headerlink" title="1.安装前准备"></a>1.安装前准备</h3><p>1.检查是否安装了gcc ,没有的话执行yum install gcc</p>
<p>2.检查是否安装了libxml2 ,没有的话执行yum install libxml2</p>
<p>3.检查是否安装了libxml2-devel,没有的话执行yum install libxml2-devel</p>
<p>4.检查是否安装了openssl,没有的话执行yum install openssl openssl-devel</p>
<p>5.curl安装 yum -y install curl-devel</p>
<p>6.图片库安装 yum install libjpeg.x86_64 libpng.x86_64 freetype.x86_64 libjpeg-devel.x86_64 libpng-devel.x86_64 freetype-devel.x86_64 -y</p>
<p>7.图片库安装 yum install libjpeg-devel</p>
<p>8.解压软件安装 yum install bzip2-devel.x86_64 -y</p>
<p>9.yum install libXpm-devel  10.yum install gmp-devel</p>
<p>10.yum install -y icu libicu libicu-devel</p>
<p>11.yum  install  php-mcrypt  libmcrypt  libmcrypt-devel</p>
<p>12.yum install  postgresql-devel</p>
<p>13.yum install libxslt-devel</p>
<h3 id="2-下载php7-1最新版-并解压"><a href="#2-下载php7-1最新版-并解压" class="headerlink" title="2.下载php7.1最新版,并解压"></a>2.下载php7.1最新版,并解压</h3><p>下载php7.1.22</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mkdir -p /opt/tools/php</div><div class="line"></div><div class="line"><span class="built_in">cd</span> /opt/tools/php</div><div class="line"></div><div class="line">wget http://cn2.php.net/distributions/php-7.1.22.tar.gz</div></pre></td></tr></table></figure>
<p>解压</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">tar -xzxvf  php-7.1.22.tar.gz</div><div class="line"></div><div class="line"><span class="built_in">cd</span> php-7.1.22</div></pre></td></tr></table></figure>
<h3 id="3-编译参数配置"><a href="#3-编译参数配置" class="headerlink" title="3.编译参数配置"></a>3.编译参数配置</h3><p>‘./configure’ ‘–prefix=/usr/local/php’ ‘–with-pdo-pgsql’ ‘–with-zlib-dir’ ‘–with-freetype-dir’ ‘–enable-mbstring’ ‘–with-libxml-dir=/usr’ ‘–enable-soap’ ‘–enable-calendar’ ‘–with-curl’ ‘–with-mcrypt’ ‘–with-gd’ ‘–with-pgsql’ ‘–disable-rpath’ ‘–enable-inline-optimization’ ‘–with-bz2’ ‘–with-zlib’ ‘–enable-sockets’ ‘–enable-sysvsem’ ‘–enable-sysvshm’ ‘–enable-pcntl’ ‘–enable-mbregex’ ‘–enable-exif’ ‘–enable-bcmath’ ‘–with-mhash’ ‘–enable-zip’ ‘–with-pcre-regex’ ‘–with-pdo-mysql’ ‘–with-mysqli’ ‘–with-jpeg-dir=/usr’ ‘–with-png-dir=/usr’ ‘–enable-gd-native-ttf’ ‘–with-openssl’ ‘–with-fpm-user=www-data’ ‘–with-fpm-group=www-data’ ‘–with-libdir=/lib/x86_64-linux-gnu/‘ ‘–enable-ftp’ ‘–with-gettext’ ‘–with-xmlrpc’ ‘–with-xsl’ ‘–enable-opcache’ ‘–enable-fpm’ ‘–with-iconv’ ‘–with-xpm-dir=/usr’</p>
<p>如果出现错误：No package libmcrypt-devel available.<br>解决办法：<br>1.yum  install epel-release  //扩展包更新包<br>2.yum  update //更新yum源</p>
<p>出现报错 Cannot find OpenSSL’s <evp.h><br>则执行 yum install openssl openssl-devel</evp.h></p>
<p>出现报错 Please reinstall the libcurl distribution<br>则执行 yum -y install curl-devel</p>
<p>出现报错 jpeglib.h not found<br>则执行 yum install libjpeg.x86_64 libpng.x86_64 freetype.x86_64 libjpeg-devel.x86_64 libpng-devel.x86_64 freetype-devel.x86_64 -y<br>和执行yum install libjpeg-devel</p>
<p>checking for BZip2 in default path… not found<br>configure: error: Please reinstall the BZip2 distribution<br>这是bzip2软件包没有安装<br>解决办法<br>yum install bzip2-devel.x86_64 -y</p>
<p>configure: error: xpm.h not found.<br>yum install libXpm-devel</p>
<p>error: Unable to locate gmp.h<br>Fix: yum install gmp-devel</p>
<p>现象：Unable to detect ICU prefix or /usr//bin/icu-config failed. Please verify ICU install<br> prefix and make sure icu-config works<br>解决办法：yum install -y icu libicu libicu-devel</p>
<p>错误：mcrypt.h not found. Please reinstall libmcrypt.<br>解决办法：yum  install  php-mcrypt  libmcrypt  libmcrypt-devel</p>
<p>错误： configure: error: Cannot find libpq-fe.h. Please specify correct PostgreSQL installation path<br>解决办法：yum install  postgresql-devel</p>
<p>错误 ： configure: error: xslt-config not found. Please reinstall the libxslt &gt;= 1.1.0 distribution<br>解决： yum install libxslt-devel</p>
<h3 id="3-编译和安装"><a href="#3-编译和安装" class="headerlink" title="3.编译和安装"></a>3.编译和安装</h3><p>配置的checking 结束后，执行：<br>make &amp;&amp; make install</p>
<h3 id="4、php配置"><a href="#4、php配置" class="headerlink" title="4、php配置"></a>4、php配置</h3><p>安装完成后，我们要把源码包中的配置文件复制到PHP安装目录下，源码包中有两个配置  php.ini-development  php.ini-production  ，看名字就知道，一个是开发环境，一个是生产环境，我们这里就复制开发环境的<br>cp php.ini-development /usr/local/php/lib/php.ini</p>
<p>另外还需要设置环境变量 ：<br>修改/etc/profile文件使其永久性生效，并对所有系统用户生效，在文件末尾加上如下两行代码<br>PATH=$PATH:/usr/local/php/bin<br>export PATH<br>然后执行 命令 source /etc/profile</p>
<p>php -v 就可以看到PHP版本信息了。</p>
<h3 id="4、php-fpm配置"><a href="#4、php-fpm配置" class="headerlink" title="4、php-fpm配置"></a>4、php-fpm配置</h3><p>此时还需要配置php-fpm:</p>
<p>cp /usr/local/php/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.conf<br>cp /usr/local/php/etc/php-fpm.d/www.conf.default /usr/local/php/etc/php-fpm.d/www.conf<br>cp ./sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm<br>chmod +x /etc/init.d/php-fpm</p>
<p>启动php-fpm:<br>/etc/init.d/php-fpm start</p>
<p>如果出现错误：ERROR: [pool www] cannot get uid for user ‘www-data’<br>则新建www-data 用户组：<br>groupadd www-data<br>useradd -g www-data www-data</p>
<p>然后再启动php-fpm：<br>service php-fpm restart</p>
<h3 id="5、php-fpm参数优化"><a href="#5、php-fpm参数优化" class="headerlink" title="5、php-fpm参数优化"></a>5、php-fpm参数优化</h3><p>vi /usr/local/php/etc/php-fpm.d/www.conf</p>
<p>1.进程数</p>
<p>php-fpm初始/空闲/最大worker进程数<br>    pm.max_children = 300<br>    pm.start_servers = 20<br>    pm.min_spare_servers = 5<br>    pm.max_spare_servers = 35</p>
<p>2.最大处理请求数</p>
<p>最大处理请求数是指一个php-fpm的worker进程在处理多少个请求后就终止掉，master进程会重新respawn一个新的。<br>这个配置的主要目的是避免php解释器或程序引用的第三方库造成的内存泄露。<br>    pm.max_requests = 10240</p>
<p>3.最长执行时间</p>
<p>最大执行时间在php.ini和php-fpm.conf里都可以配置，配置项分别为max_execution_time和request_terminate_timeout</p>
<h3 id="6、Unix域Socket通信"><a href="#6、Unix域Socket通信" class="headerlink" title="6、Unix域Socket通信"></a>6、Unix域Socket通信</h3><p>之前简单介绍过Unix Domain Socket这种通信方式，参见：<a href="https://blog.csdn.net/dc_726/article/details/9336193" target="_blank" rel="external">Nginx+PHP-FPM的域Socket配置方法</a></p>
<p>Unix域Socket因为不走网络，的确可以提高Nginx和php-fpm通信的性能，但在高并发时会不稳定。<br>Nginx会频繁报错：<br>     connect() to unix:/dev/shm/php-fcgi.sock failed (11: Resource temporarily unavailable) while connecting to upstream</p>
<p>可以通过下面两种方式提高稳定性：<br>1）调高nginx和php-fpm中的backlog<br>     配置方法为：在nginx配置文件中这个域名的server下，在listen 80后面添加default backlog=1024。<br>     同时配置php-fpm.conf中的listen.backlog为1024，默认为128。<br>2）增加sock文件和php-fpm实例数<br>     再新建一个sock文件，在Nginx中通过upstream模块将请求负载均衡到两个sock文件背后的两套php-fpm实例上。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/23/love/yese/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sir051223">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Forest">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/23/love/yese/" itemprop="url">夜色</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-23T15:52:51+08:00">
                2018-10-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/爱情/" itemprop="url" rel="index">
                    <span itemprop="name">爱情</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="夜色"><a href="#夜色" class="headerlink" title="夜色"></a>夜色</h3><p>夜色正阑珊，微微荧光闪闪。<br>一遍又一遍，轻轻把你呼唤。<br>阵阵风声好像对我在叮咛，真情怎能忘记。<br>你可记得对你许下的诺言，爱你情深意绵。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/22/linux/nginx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sir051223">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Forest">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/22/linux/nginx/" itemprop="url">nginx负载均衡</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-22T11:28:11+08:00">
                2018-10-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>随着网站、应用访问量的增加，一台服务器已经不能满足应用的需求，而需要多台服务器集群，这时就需要用到负载均衡了</p>
<p>负载均衡的好处</p>
<p>负载均衡优化了访问请求在服务器组之间的分配，消除了服务器之间的负载不平衡，从而提高了系统的反应速度与总体性能；</p>
<p>负载均衡可以对服务器的运行状况进行监控，及时发现运行异常的服务器，并将访问请求转移到其它可以正常工作的服务器上，从而提高服务器组的可靠性采用了负均衡器器以后，可以根据业务量的发展情况灵活增加服务器，系统的扩展能力得到提高，同时简化了管理。</p>
<h2 id="负载均衡的几种常用方式"><a href="#负载均衡的几种常用方式" class="headerlink" title="负载均衡的几种常用方式"></a>负载均衡的几种常用方式</h2><h3 id="1-轮询（默认）"><a href="#1-轮询（默认）" class="headerlink" title="1.轮询（默认）"></a>1.轮询（默认）</h3><p>每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器down掉，能自动剔除。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">upstream backserver &#123;</div><div class="line">    server 192.168.0.14;</div><div class="line">    server 192.168.0.15;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2-weight权重"><a href="#2-weight权重" class="headerlink" title="2.weight权重"></a>2.weight权重</h3><p>指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">upstream backserver &#123;</div><div class="line">    server 192.168.0.14 weight=3;</div><div class="line">    server 192.168.0.15 weight=7;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>权重越高，在被访问的概率越大，如上例，分别是30%，70%</p>
<h3 id="3-ip-hash-（解决session问题）"><a href="#3-ip-hash-（解决session问题）" class="headerlink" title="3.ip_hash （解决session问题）"></a>3.ip_hash （解决session问题）</h3><p>方式1和2存在一个问题，在负载均衡系统中，假如用户在某台服务器上登录了，那么该用户第二次请求的时候，每次请求都会随机重新定位到服务器集群中的某一个，那么已经登录某一个服务器的用户再重新定位到另一个服务器，其登录信息将会丢失，这样显然是不妥的。</p>
<p>我们可以采用ip_hash指令解决这个问题，如果客户已经访问了某个服务器，当用户再次访问时，会将该请求通过哈希算法，自动定位到该服务器</p>
<p>每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题。</p>
<p>在redis.conf中进行配置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">upstream backserver &#123;</div><div class="line">    ip_hash;</div><div class="line">    server 192.168.0.14:88;</div><div class="line">    server 192.168.0.15:80;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="4、fair（第三方）"><a href="#4、fair（第三方）" class="headerlink" title="4、fair（第三方）"></a>4、fair（第三方）</h3><p>按后端服务器的响应时间来分配请求，响应时间短的优先分配。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">upstream backserver &#123;</div><div class="line">    server server1;</div><div class="line">    server server2;</div><div class="line">    fair;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="5、url-hash（第三方）"><a href="#5、url-hash（第三方）" class="headerlink" title="5、url_hash（第三方）"></a>5、url_hash（第三方）</h3><p>按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，后端服务器为缓存时比较有效。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">upstream backserver &#123;</div><div class="line">    server squid1:3128;</div><div class="line">    server squid2:3128;</div><div class="line">    <span class="built_in">hash</span> <span class="variable">$request_uri</span>;</div><div class="line">    hash_method crc32;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="LNMP环境下负载均衡"><a href="#LNMP环境下负载均衡" class="headerlink" title="LNMP环境下负载均衡"></a>LNMP环境下负载均衡</h2><h3 id="1-域名解析"><a href="#1-域名解析" class="headerlink" title="1.域名解析"></a>1.域名解析</h3><p>以阿里云服务器为例，进入阿里云管理后台，域名管理处，选择excample.com域名解析到服务器ip</p>
<h3 id="2-nginx配置"><a href="#2-nginx配置" class="headerlink" title="2.nginx配置"></a>2.nginx配置</h3><p>域名解析后，进入nginx配置文件，（以centos 7下的yum install nginx为例）</p>
<p>80端口分发服务配置</p>
<p>vi /etc/nginx/conf.d/test_example_com.conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">upstream test.example.com &#123;</div><div class="line"><span class="comment">#    ip_hash;</span></div><div class="line">    server 192.168.214.81:8089 weight=5;</div><div class="line">    server 192.168.214.81:8088 weight=3;</div><div class="line">&#125;</div><div class="line"></div><div class="line">server &#123;</div><div class="line">	listen       80;</div><div class="line">	server_name  test.example.com;</div><div class="line">		</div><div class="line">    location / &#123;</div><div class="line">	    proxy_pass   http://test.example.com;</div><div class="line">        proxy_set_header   Host             <span class="variable">$host</span>;</div><div class="line">        proxy_set_header   X-Real-IP        <span class="variable">$remote_addr</span>;</div><div class="line">        proxy_set_header   X-Forwarded-For  <span class="variable">$proxy_add_x_forwarded_for</span>;</div><div class="line">	    index index.php index.html index.htm;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">注意：proxy_pass反向代理的upstream域名需要和server_name一致，否则会出现访问报错</div></pre></td></tr></table></figure>
<p>8088端口解析服务配置</p>
<p>vi /etc/nginx/conf.d/example8088.conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">server</div><div class="line">&#123;</div><div class="line">    listen  8088;</div><div class="line">    server_name  192.168.214.81;</div><div class="line">    index index.php index.htm index.html;</div><div class="line">    root    /opt/web/xxx/public/;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">        location ~* \.(js|css|html|htm)$ &#123;</div><div class="line">            <span class="keyword">if</span> (<span class="_">-f</span> <span class="variable">$request_filename</span>) &#123;</div><div class="line">                root /opt/web/a/public/;</div><div class="line">                expires  1d;</div><div class="line">                <span class="built_in">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (!<span class="_">-e</span> <span class="variable">$request_filename</span>) &#123;</div><div class="line">            rewrite  ^(.*)$  /index.php?s=/<span class="variable">$1</span>  last;</div><div class="line">        &#125;</div><div class="line">        index index.php index.html index.htm;</div><div class="line">        try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location ~ \.php$ &#123;</div><div class="line">        try_files <span class="variable">$uri</span> =404;</div><div class="line">        fastcgi_pass   127.0.0.1:9000;</div><div class="line">        fastcgi_index  index.php;</div><div class="line">        fastcgi_param  SCRIPT_FILENAME   <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</div><div class="line">        include        fastcgi_params;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>8089端口解析服务配置</p>
<p>vi /etc/nginx/conf.d/example8089.conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">server</div><div class="line">&#123;</div><div class="line">    listen  8089;</div><div class="line">    server_name  192.168.214.81;</div><div class="line">    index index.php index.htm index.html;</div><div class="line">    root    /opt/web/xxx/public/;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">        location ~* \.(js|css|html|htm)$ &#123;</div><div class="line">            <span class="keyword">if</span> (<span class="_">-f</span> <span class="variable">$request_filename</span>) &#123;</div><div class="line">                root /opt/web/b/public/;</div><div class="line">                expires  1d;</div><div class="line">                <span class="built_in">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (!<span class="_">-e</span> <span class="variable">$request_filename</span>) &#123;</div><div class="line">            rewrite  ^(.*)$  /index.php?s=/<span class="variable">$1</span>  last;</div><div class="line">        &#125;</div><div class="line">        index index.php index.html index.htm;</div><div class="line">        try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location ~ \.php$ &#123;</div><div class="line">        try_files <span class="variable">$uri</span> =404;</div><div class="line">        fastcgi_pass   127.0.0.1:9000;</div><div class="line">        fastcgi_index  index.php;</div><div class="line">        fastcgi_param  SCRIPT_FILENAME   <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</div><div class="line">        include        fastcgi_params;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>重启web服务器nginx<br>service nginx restart</p>
<p>往两个系统的首页写入标识内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="string">'8088 a'</span> /opt/web/a/public/index.html</div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">'8089 b'</span> /opt/web/b/public/index.html</div></pre></td></tr></table></figure>
<p>浏览器访问 test.excample.com</p>
<p>可以看到不停的变换’8089 b’和’8088 a’ 说明负载均衡成功运行</p>
<p>将ip_hash;前的#号去掉，重启web服务器nginx</p>
<p>service nginx restart</p>
<p>浏览器访问 test.excample.com</p>
<p>可以浏览器输出的内容并不会变换，说明iphash模式下的负载均衡运行成功</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>nginx监听本地的80端口，80端口接收到请求后，将请求转发到192.168.214.81:8089，192.168.214.81:8088应用中的其中一个，如果映射的策略是ip_hash，这个策略会对请求的ip进行hash运算并将结果映射到其中一个应用，它能确保一个确定的请求ip会被映射到一个确定的服务，这样就连session的问题也就解决了。如果不需要考虑session，可选用默认的轮询或权重</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/19/linux/nfs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sir051223">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Forest">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/19/linux/nfs/" itemprop="url">Linux Centos 7下NFS服务器的搭建与配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-19T12:26:01+08:00">
                2018-10-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、NFS服务简介"><a href="#一、NFS服务简介" class="headerlink" title="一、NFS服务简介"></a>一、NFS服务简介</h2><p>NFS 就是 Network FileSystem 的缩写，最早之前是由sun 这家公司所发展出来的。 它最大的功能就是可以透过网络，让不同的机器、不同的操作系统、可以彼此分享个别的档案 (share files)。所以，你也可以简单的将他看做是一个文件服务器 (file server) 呢！这个 NFS 服务器可以让你的 PC 来将网络远程的 NFS 服务器分享的目录，挂载到本地端的机器当中， 在本地端的机器看起来，那个远程主机的目录就好像是自己的一个磁盘分区槽一样 (partition)！使用上面相当的便利！</p>
<p>因为 NFS 支持的功能相当的多，而不同的功能都会使用不同的程序来启动， 每启动一个功能就会启用一些端口来传输数据，因此， NFS 的功能所对应的端口才没有固定住， 而是随机取用一些未被使用的小于 1024 的端口来作为传输之用。但如此一来又造成客户端想要连上服务器时的困扰， 因为客户端得要知道服务器端的相关端口才能够联机吧！</p>
<p>此时我们就得需要远程过程调用 (RPC) 的服务啦！RPC 最主要的功能就是在指定每个 NFS 功能所对应的 port number ，并且回报给客户端，让客户端可以连结到正确的端口上去。 那 RPC 又是如何知道每个 NFS 的端口呢？这是因为当服务器在启动 NFS 时会随机取用数个端口，并主动的向 RPC 注册，因此 RPC 可以知道每个端口对应的 NFS 功能，然后 RPC 又是固定使用 port 111 来监听客户端的需求并回报客户端正确的端口， 所以当然可以让 NFS 的启动更为轻松愉快了！</p>
<p>所以你要注意，要启动 NFS 之前，RPC 就要先启动了，否则 NFS 会无法向 RPC 注册。 另外，RPC 若重新启动时，原本注册的数据会不见，因此 RPC 重新启动后，它管理的所有服务都需要重新启动来重新向 RPC 注册。</p>
<p>当客户端有 NFS 档案存取需求时，他会如何向服务器端要求数据呢？<br>1、客户端会向服务器端的 RPC (port 111) 发出 NFS 档案存取功能的询问要求；<br>2、服务器端找到对应的已注册的 NFS daemon 端口后，会回报给客户端；<br>3、客户端了解正确的埠口后，就可以直接与 NFS daemon 来联机。</p>
<p>由于 NFS 的各项功能都必须要向 RPC 来注册，如此一来 RPC 才能了解 NFS 这个服务的各项功能之 port number, PID, NFS 在服务器所监听的 IP 等等，而客户端才能够透过 RPC 的询问找到正确对应的埠口。 也就是说，NFS 必须要有 RPC 存在时才能成功的提供服务，因此我们称 NFS 为 RPC server 的一种。事实上，有很多这样的服务器都是向 RPC 注册的，举例来说，NIS (Network Information Service) 也是 RPC server 的一种呢</p>
<h2 id="二、所需要的软件及软件结构"><a href="#二、所需要的软件及软件结构" class="headerlink" title="二、所需要的软件及软件结构"></a>二、所需要的软件及软件结构</h2><p>要设定好 NFS 服务器我们必须要有两个软件才行，分别是：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">1.RPC 主程序：rpcbind</div><div class="line"></div><div class="line">2.NFS 主程序：nfs-utils</div></pre></td></tr></table></figure>
<p>NFS 记录文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">1.主要配置文件：/etc/exports</div><div class="line"></div><div class="line">2.NFS 文件系统维护指令：/usr/sbin/exportfs</div><div class="line"></div><div class="line">3.分享资源的登录档：/var/lib/nfs/*tab</div><div class="line"></div><div class="line">4.客户端查询服务器分享资源的指令：/usr/sbin/showmount</div></pre></td></tr></table></figure>
<h2 id="三、系统环境"><a href="#三、系统环境" class="headerlink" title="三、系统环境"></a>三、系统环境</h2><p>系统CentOS7.1</p>
<p>服务器端IP 192.168.214.71<br>客户端IP   192.168.214.81</p>
<h2 id="四、服务器端安装NFS服务"><a href="#四、服务器端安装NFS服务" class="headerlink" title="四、服务器端安装NFS服务"></a>四、服务器端安装NFS服务</h2><h4 id="1-查看系统是否已安装NFS"><a href="#1-查看系统是否已安装NFS" class="headerlink" title="1.查看系统是否已安装NFS"></a>1.查看系统是否已安装NFS</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@bingo ~]<span class="comment"># rpm -qa | grep nfs</span></div><div class="line">[root@bingo ~]<span class="comment"># rpm -qa | grep rpcbind</span></div></pre></td></tr></table></figure>
<h4 id="2-安装NFS"><a href="#2-安装NFS" class="headerlink" title="2.安装NFS"></a>2.安装NFS</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@bingo ~]<span class="comment"># yum -y install nfs-utils rpcbind</span></div><div class="line">已加载插件：fastestmirror</div><div class="line">设置安装进程</div><div class="line">Loading mirror speeds from cached hostfile</div><div class="line">... ...                        </div><div class="line"></div><div class="line">完毕！</div></pre></td></tr></table></figure>
<h2 id="五、服务端配置"><a href="#五、服务端配置" class="headerlink" title="五、服务端配置"></a>五、服务端配置</h2><h4 id="1-在NFS服务端上创建共享目录-opt-files-lys并设置权限"><a href="#1-在NFS服务端上创建共享目录-opt-files-lys并设置权限" class="headerlink" title="1.在NFS服务端上创建共享目录/opt/files/lys并设置权限"></a>1.在NFS服务端上创建共享目录/opt/files/lys并设置权限</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@bingo ~]<span class="comment"># mkdir -p /opt/files/lys</span></div><div class="line">[root@bingo ~]<span class="comment"># ll /opt/files/</span></div><div class="line">总用量 4</div><div class="line">drwxr-xr-x. 2 root root 4096 10月 21 18:10 lys</div><div class="line">[root@bingo ~]<span class="comment"># chmod 666 /opt/files/lys</span></div></pre></td></tr></table></figure>
<h4 id="2-编辑export文件"><a href="#2-编辑export文件" class="headerlink" title="2.编辑export文件"></a>2.编辑export文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@bingo ~]<span class="comment"># vim /etc/exports </span></div><div class="line"></div><div class="line">/opt/files/lys 192.168.214.0/24(rw,no_root_squash,no_all_squash,sync)</div><div class="line"></div><div class="line">/opt/web/xxx   192.168.214.*(rw,sync,no_root_squash)  <span class="comment">#可挂载文件夹可设置多个</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">常见的参数则有：</div><div class="line"></div><div class="line">参数值    内容说明</div><div class="line">rw　ro    该目录分享的权限是可擦写 (<span class="built_in">read</span>-write) 或只读 (<span class="built_in">read</span>-only)，但最终能不能读写，还是与文件系统的 rwx 及身份有关。</div><div class="line"></div><div class="line">sync　async    sync代表数据会同步写入到内存与硬盘中，async 则代表数据会先暂存于内存当中，而非直接写入硬盘！</div><div class="line"></div><div class="line">no_root_squash　root_squash    客户端使用 NFS 文件系统的账号若为 root 时，系统该如何判断这个账号的身份？预设的情况下，</div><div class="line">客户端 root 的身份会由 root_squash 的设定压缩成 nfsnobody， 如此对服务器的系统会较有保障。但如果你想要开放客户端使用 </div><div class="line">root 身份来操作服务器的文件系统，那么这里就得要开 no_root_squash 才行！</div><div class="line"></div><div class="line">all_squash    不论登入 NFS 的使用者身份为何， 他的身份都会被压缩成为匿名用户，通常也就是 nobody(nfsnobody) </div><div class="line"></div><div class="line">anonuid　　anongid    anon 意指 anonymous (匿名者) 前面关于 *_squash 提到的匿名用户的 UID 设定值，通常为 nobody</div><div class="line">(nfsnobody)，但是你可以自行设定这个 UID 的值！当然，这个 UID 必需要存在于你的 /etc/passwd 当中！ anonuid 指的是 </div><div class="line">UID 而 anongid 则是群组的 GID 。</div></pre></td></tr></table></figure>
<h4 id="3-配置生效"><a href="#3-配置生效" class="headerlink" title="3.配置生效"></a>3.配置生效</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@bingo lys]<span class="comment"># exportfs -r</span></div></pre></td></tr></table></figure>
<h4 id="4-启动rpcbind、nfs服务"><a href="#4-启动rpcbind、nfs服务" class="headerlink" title="4.启动rpcbind、nfs服务"></a>4.启动rpcbind、nfs服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@bingo lys]<span class="comment"># service rpcbind start</span></div><div class="line">正在启动 rpcbind：                                         [确定]</div><div class="line">[root@bingo lys]<span class="comment"># service nfs start</span></div><div class="line">启动 NFS 服务：                                            [确定]</div><div class="line">启动 NFS mountd：                                          [确定]</div><div class="line">启动 NFS 守护进程：                                        [确定]</div><div class="line">正在启动 RPC idmapd：                                      [确定]</div></pre></td></tr></table></figure>
<h4 id="5-查看-RPC-服务的注册状况"><a href="#5-查看-RPC-服务的注册状况" class="headerlink" title="5.查看 RPC 服务的注册状况"></a>5.查看 RPC 服务的注册状况</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@bingo lys]<span class="comment"># rpcinfo -p localhost</span></div><div class="line">   program vers proto   port  service</div><div class="line">    100000    4   tcp    111  portmapper</div><div class="line">    .</div><div class="line">    .</div><div class="line">    .</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">选项与参数：</div><div class="line">-p ：针对某 IP (未写则预设为本机) 显示出所有的 port 与 porgram 的信息；</div><div class="line">-t ：针对某主机的某支程序检查其 TCP 封包所在的软件版本；</div><div class="line">-u ：针对某主机的某支程序检查其 UDP 封包所在的软件版本；</div><div class="line"></div><div class="line">（注意，服务端对应的端口需开放给客户端才可以挂载，可使用telnet IPAddress port(端口如111)测试）</div></pre></td></tr></table></figure>
<p>在你的 NFS 服务器设定妥当之后，我们可以在 server 端先自我测试一下是否可以联机，利用 showmount 这个指令来查阅！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@bingo lys]<span class="comment"># showmount -e localhost</span></div><div class="line">Export list <span class="keyword">for</span> localhost:</div><div class="line">/opt/files/lys 192.168.214.0/24</div><div class="line">/opt/web/xxx   192.168.214.*</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">选项与参数：</div><div class="line"><span class="_">-a</span> ：显示目前主机与客户端的 NFS 联机分享的状态；</div><div class="line"><span class="_">-e</span> ：显示某部主机的 /etc/exports 所分享的目录数据。</div></pre></td></tr></table></figure>
<h2 id="六、客户端配置"><a href="#六、客户端配置" class="headerlink" title="六、客户端配置"></a>六、客户端配置</h2><h4 id="1-安装nfs-utils客户端"><a href="#1-安装nfs-utils客户端" class="headerlink" title="1.安装nfs-utils客户端"></a>1.安装nfs-utils客户端</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@bingo ~]<span class="comment"># yum -y install nfs-utils</span></div><div class="line">.</div><div class="line">.</div><div class="line">. </div><div class="line"></div><div class="line">完毕！</div></pre></td></tr></table></figure>
<h4 id="2-创建挂载目录"><a href="#2-创建挂载目录" class="headerlink" title="2.创建挂载目录"></a>2.创建挂载目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@bingo ~]<span class="comment"># mkdir -p /opt/web/public</span></div></pre></td></tr></table></figure>
<h4 id="3-查看服务器抛出的共享目录信息"><a href="#3-查看服务器抛出的共享目录信息" class="headerlink" title="3.查看服务器抛出的共享目录信息"></a>3.查看服务器抛出的共享目录信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@bingo ~]<span class="comment"># showmount -e 192.168.214.71</span></div><div class="line">Export list <span class="keyword">for</span> 192.168.214.71:</div><div class="line">/opt/files/lys 192.168.214.0/24</div><div class="line">/opt/web/xxx   192.168.214.*</div></pre></td></tr></table></figure>
<h4 id="4-挂载目录"><a href="#4-挂载目录" class="headerlink" title="4.挂载目录"></a>4.挂载目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">一、普通挂载</div><div class="line"></div><div class="line">[root@bingo ~]<span class="comment"># mount 192.168.214.71:/opt/files/lys /opt/web/public</span></div><div class="line"></div><div class="line">二、使用TCP协议挂载（NFS默认用UDP协议，TCP协议可提高NFS的稳定性）</div><div class="line"></div><div class="line">[root@bingo ~]<span class="comment"># mount -t nfs 192.168.214.71:/opt/files/lys /opt/web/public -o proto=tcp -o nolock</span></div><div class="line"></div><div class="line">挂载遵循（from to）前者为来源，后者为目标</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">常见的参数则有：</div><div class="line"></div><div class="line">参数值    内容说明</div><div class="line">rw　ro    该目录分享的权限是可擦写 (<span class="built_in">read</span>-write) 或只读 (<span class="built_in">read</span>-only)，但最终能不能读写，还是与文件系统的 rwx 及身份有关。</div><div class="line"></div><div class="line">sync　async    sync代表数据会同步写入到内存与硬盘中，async 则代表数据会先暂存于内存当中，而非直接写入硬盘！</div><div class="line"></div><div class="line">no_root_squash　root_squash    客户端使用 NFS 文件系统的账号若为 root 时，系统该如何判断这个账号的身份？预设的情况下，</div><div class="line">客户端 root 的身份会由 root_squash 的设定压缩成 nfsnobody， 如此对服务器的系统会较有保障。但如果你想要开放客户端使用 </div><div class="line">root 身份来操作服务器的文件系统，那么这里就得要开 no_root_squash 才行！</div><div class="line"></div><div class="line">all_squash    不论登入 NFS 的使用者身份为何， 他的身份都会被压缩成为匿名用户，通常也就是 nobody(nfsnobody) </div><div class="line"></div><div class="line">anonuid　　anongid    anon 意指 anonymous (匿名者) 前面关于 *_squash 提到的匿名用户的 UID 设定值，通常为 nobody</div><div class="line">(nfsnobody)，但是你可以自行设定这个 UID 的值！当然，这个 UID 必需要存在于你的 /etc/passwd 当中！ anonuid 指的是 </div><div class="line">UID 而 anongid 则是群组的 GID 。</div></pre></td></tr></table></figure>
<h4 id="3-配置生效-1"><a href="#3-配置生效-1" class="headerlink" title="3.配置生效"></a>3.配置生效</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@bingo lys]<span class="comment"># exportfs -r</span></div></pre></td></tr></table></figure>
<h2 id="七、测试结果"><a href="#七、测试结果" class="headerlink" title="七、测试结果"></a>七、测试结果</h2><h4 id="1-查看挂载结果"><a href="#1-查看挂载结果" class="headerlink" title="1.查看挂载结果"></a>1.查看挂载结果</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@bingo ~]<span class="comment"># df -h</span></div><div class="line">Filesystem            Size  Used Avail Use% Mounted on</div><div class="line">/dev/xxx</div><div class="line">                       18G  1.1G   16G   7% /</div><div class="line">tmpfs                 112M     0  112M   0% /dev/shm</div><div class="line">/dev/sda1             477M   54M  398M  12% /boot</div><div class="line">192.168.214.71:/opt/files/lys</div><div class="line">                       180G  1.1G   16G   0.7% /opt/web/public</div></pre></td></tr></table></figure>
<h4 id="2-服务端"><a href="#2-服务端" class="headerlink" title="2.服务端"></a>2.服务端</h4><p>创建test.txt并往文件中写入内容test<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@bingo lys]<span class="comment"># echo "test" &gt; test.txt</span></div></pre></td></tr></table></figure></p>
<h4 id="3-客户端"><a href="#3-客户端" class="headerlink" title="3.客户端"></a>3.客户端</h4><p>查看test.txt文件内容并写入内容1024</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@bingo ~]<span class="comment"># cat /opt/web/public/test.txt </span></div><div class="line"><span class="built_in">test</span></div><div class="line">[root@bingo ~]<span class="comment"># echo "1024" &gt;&gt; /opt/web/public/test.txt</span></div></pre></td></tr></table></figure>
<h4 id="4-服务端"><a href="#4-服务端" class="headerlink" title="4.服务端"></a>4.服务端</h4><p>查看test.txt文件内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@bingo lys]<span class="comment"># cat /opt/files/lys/test.txt </span></div><div class="line"><span class="built_in">test</span></div><div class="line">1024</div></pre></td></tr></table></figure>
<h2 id="八、卸载已挂在的NFS"><a href="#八、卸载已挂在的NFS" class="headerlink" title="八、卸载已挂在的NFS"></a>八、卸载已挂在的NFS</h2><h4 id="1-查看挂载结果-1"><a href="#1-查看挂载结果-1" class="headerlink" title="1.查看挂载结果"></a>1.查看挂载结果</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@bingo ~]<span class="comment"># umount /opt/web/public</span></div><div class="line">[root@bingo ~]<span class="comment"># df -h</span></div><div class="line">Filesystem            Size  Used Avail Use% Mounted on</div><div class="line">/dev/xxx</div><div class="line">                       18G  1.1G   16G   7% /</div><div class="line">tmpfs                 112M     0  112M   0% /dev/shm</div><div class="line">/dev/sda1             477M   54M  398M  12% /boot</div></pre></td></tr></table></figure>
<h2 id="九、防火墙"><a href="#九、防火墙" class="headerlink" title="九、防火墙"></a>九、防火墙</h2><h4 id="1-查看挂载结果-2"><a href="#1-查看挂载结果-2" class="headerlink" title="1.查看挂载结果"></a>1.查看挂载结果</h4><p>为了方便配置防火墙，需要固定nfs服务端口</p>
<p>NFS启动时会随机启动多个端口并向RPC注册，这样如果使用firewalls对NFS端口进行限制就会有点麻烦，可以更改配置文件固定NFS服务相关端口。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@bingo lys]<span class="comment"># rpcinfo -p localhost</span></div><div class="line">   program vers proto   port  service</div><div class="line">    100000    4   tcp    111  portmapper</div><div class="line">    100000    3   tcp    111  portmapper</div><div class="line">    100000    2   tcp    111  portmapper</div><div class="line">    100000    4   udp    111  portmapper</div><div class="line">    100000    3   udp    111  portmapper</div><div class="line">    100000    2   udp    111  portmapper</div><div class="line">    100005    1   udp  49979  mountd</div><div class="line">. </div><div class="line">.</div></pre></td></tr></table></figure>
<p>分配端口，编辑配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@bingo lys]<span class="comment"># vim /etc/sysconfig/nfs</span></div></pre></td></tr></table></figure>
<p>添加：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">RQUOTAD_PORT=30001</div><div class="line">LOCKD_TCPPORT=30002</div><div class="line">LOCKD_UDPPORT=30002</div><div class="line">MOUNTD_PORT=30003</div><div class="line">STATD_PORT=30004</div></pre></td></tr></table></figure>
<p>重启：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@bingo lys]<span class="comment"># service nfs restart</span></div><div class="line">关闭 NFS 守护进程：                                        [确定]</div><div class="line">关闭 NFS mountd：                                          [确定]</div><div class="line">关闭 NFS 服务：                                            [确定]</div><div class="line">Shutting down RPC idmapd:                                  [确定]</div><div class="line">启动 NFS 服务：                                            [确定]</div><div class="line">启动 NFS mountd：                                          [确定]</div><div class="line">启动 NFS 守护进程：                                        [确定]</div><div class="line">正在启动 RPC idmapd：                                      [确定]</div></pre></td></tr></table></figure>
<p>查看结果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@bingo lys]<span class="comment"># rpcinfo -p localhost</span></div><div class="line">   program vers proto   port  service</div><div class="line">    100000    4   tcp    111  portmapper</div><div class="line">    100000    3   tcp    111  portmapper</div><div class="line">    100000    2   tcp    111  portmapper</div><div class="line">    100000    4   udp    111  portmapper</div><div class="line">    100000    3   udp    111  portmapper</div><div class="line">    100000    2   udp    111  portmapper</div><div class="line">    100005    1   udp  30003  mountd</div><div class="line">    100005    1   tcp  30003  mountd</div><div class="line">    100005    2   udp  30003  mountd</div><div class="line">    100005    2   tcp  30003  mountd</div><div class="line">    100005    3   udp  30003  mountd</div></pre></td></tr></table></figure>
<p>可以看到，随机端口以固定</p>
<p>firewalls策略问题完美解决！！！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="sir051223" />
          <p class="site-author-name" itemprop="name">sir051223</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">28</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">sir051223</span>

  
</div>



        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
